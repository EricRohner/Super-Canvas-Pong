{"ast":null,"code":"import _classCallCheck from \"/Users/ericrohner/Projects/pong-r/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ericrohner/Projects/pong-r/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/ericrohner/Projects/pong-r/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ericrohner/Projects/pong-r/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/ericrohner/Projects/pong-r/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/ericrohner/Projects/pong-r/src/components/GameCanvas.js\";\nimport React, { Component } from \"react\";\n\nvar GameCanvas =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(GameCanvas, _Component);\n\n  function GameCanvas(props) {\n    var _this;\n\n    _classCallCheck(this, GameCanvas);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(GameCanvas).call(this, props)); //deadBalls is only ever pushed to, never referenced and never cleared\n    //we can safely remove it completely from the codebase\n    //this.deadBalls = [];\n\n    _this.componentDidMount = function () {\n      _this._initializeGameCanvas();\n    };\n\n    _this._initializeGameCanvas = function () {\n      // initialize canvas element and bind it to our React class\n      _this.canvas = _this.refs.pong_canvas;\n      _this.ctx = _this.canvas.getContext(\"2d\"); // declare initial variables\n\n      _this.p1Score = 0;\n      _this.p2Score = 0;\n      _this.keys = {}; // add keyboard input listeners to handle user interactions\n\n      window.addEventListener(\"keydown\", function (e) {\n        _this.keys[e.keyCode] = 1;\n        if (e.target.nodeName !== \"INPUT\") e.preventDefault();\n      });\n      window.addEventListener(\"keyup\", function (e) {\n        return delete _this.keys[e.keyCode];\n      }); // instantiate our game elements\n\n      _this.player1 = new _this.GameClasses.Box({\n        x: 10,\n        y: 200,\n        width: _this.props.paddle1Width,\n        height: 80,\n        color: \"#FFF\",\n        velocityY: 2\n      });\n      _this.player2 = new _this.GameClasses.Box({\n        x: 725,\n        y: 200,\n        width: 15,\n        height: 80,\n        color: \"#FFF\",\n        velocityY: 2\n      });\n      _this.boardDivider = new _this.GameClasses.Box({\n        x: _this.canvas.width / 2 - 2.5,\n        y: -1,\n        width: 5,\n        height: _this.canvas.height + 1,\n        color: \"#FFF\"\n      });\n      _this.gameBall = new _this.GameClasses.Box({\n        x: _this.canvas.width / 2,\n        y: _this.canvas.height / 2,\n        width: 15,\n        height: 15,\n        color: \"#FF0000\",\n        velocityX: 1,\n        velocityY: 1\n      }); // start render loop\n\n      _this._renderLoop();\n    };\n\n    _this._renderLoop = function () {\n      _this._ballCollisionY();\n\n      _this._userInput(_this.player1);\n\n      _this._userInput(_this.player2);\n\n      _this.frameId = window.requestAnimationFrame(_this._renderLoop);\n    };\n\n    _this._ballCollisionY = function () {\n      if (_this.gameBall.y + _this.gameBall.velocityY <= 0 || _this.gameBall.y + _this.gameBall.velocityY + _this.gameBall.height >= _this.canvas.height) {\n        _this.gameBall.velocityY = _this.gameBall.velocityY * -1;\n        _this.gameBall.x += _this.gameBall.velocityX;\n        _this.gameBall.y += _this.gameBall.velocityY;\n      } else {\n        _this.gameBall.x += _this.gameBall.velocityX;\n        _this.gameBall.y += _this.gameBall.velocityY;\n      }\n\n      _this._ballCollisionX();\n    };\n\n    _this._ballCollisionX = function () {\n      if (_this.gameBall.x + _this.gameBall.velocityX <= _this.player1.x + _this.player1.width && _this.gameBall.y + _this.gameBall.velocityY > _this.player1.y && _this.gameBall.y + _this.gameBall.velocityY <= _this.player1.y + _this.player1.height) {\n        //Fixed bug where \"catching\" the ball with the top or bottom of the paddle\n        //would result in it switching X direction every frame. Since few players have frame\n        //perfect timing this essentially gives the top and bottom of the paddle a 50/50 chance\n        //to lose the volley. Players don't like random chance when it can only hurt them.\n        _this.gameBall.velocityX = _this.initXVelocity; //Added VelocityY change from moving paddle. Velocity change is increased every frame until\n        //the ball exits the paddle when hitting the ball with the top or bottom of the the paddle.\n        //As this requires skill and rewards the player by making a return more difficult it's a\n        //gameplay feature, not a bug. Also, it just feels right for the game physics.\n\n        if (83 in _this.keys) {\n          _this.gameBall.velocityY += 1;\n        } else if (87 in _this.keys) {\n          _this.gameBall.velocityY -= 1;\n        }\n      } else if (_this.gameBall.x + _this.gameBall.width + _this.gameBall.velocityX >= _this.player2.x && _this.gameBall.y + _this.gameBall.velocityY > _this.player2.y && _this.gameBall.y + _this.gameBall.velocityY <= _this.player2.y + _this.player2.height) {\n        //Fixed bug where \"catching\" the ball with the top or bottom of the paddle\n        //would result in it switching X direction every frame. Since few players have frame\n        //perfect timing this essentially gives the top and bottom of the paddle a 50/50 chance\n        //to lose the volley. Players don't like random chance when it can only hurt them.\n        _this.gameBall.velocityX = _this.initXVelocity * -1; //Added VelocityY change from moving paddle. Velocity change is increased every frame until\n        //the ball exits the paddle when hitting the ball with the top or bottom of the the paddle.\n        //As this requires skill and rewards the player by making a return more difficult it's a\n        //gameplay feature, not a bug. Also, it just feels right for the game physics.\n\n        if (40 in _this.keys) {\n          _this.gameBall.velocityY += 1;\n        } else if (38 in _this.keys) {\n          _this.gameBall.velocityY -= 1;\n        }\n      } else if (_this.gameBall.x + _this.gameBall.velocityX < _this.player1.x - 15) {\n        _this.p2Score += 1; //this.deadBalls appears to be an intentional memory leak\n        //this.deadBalls.push(this.gameBall);\n\n        _this.gameBall = new _this.GameClasses.Box({\n          x: _this.canvas.width / 2,\n          y: _this.canvas.height / 2,\n          width: 15,\n          height: 15,\n          color: \"#FF0000\",\n          velocityX: _this.initXVelocity,\n          velocityY: 1\n        });\n      } else if (_this.gameBall.x + _this.gameBall.velocityX > _this.player2.x + _this.player2.width) {\n        _this.p1Score += 1; //this.deadBalls appears to be an intentional memory leak\n        //this.deadBalls.push(this.gameBall);\n\n        _this.gameBall = new _this.GameClasses.Box({\n          x: _this.canvas.width / 2,\n          y: _this.canvas.height / 2,\n          width: 15,\n          height: 15,\n          color: \"#FF0000\",\n          velocityX: _this.initXVelocity * -1,\n          velocityY: 1\n        });\n      } else {\n        _this.gameBall.x += _this.gameBall.velocityX;\n        _this.gameBall.y += _this.gameBall.velocityY;\n      }\n\n      _this._drawRender();\n    };\n\n    _this._drawRender = function () {\n      _this.ctx.clearRect(0, 0, _this.canvas.width, _this.canvas.height);\n\n      _this._displayScore1();\n\n      _this._displayScore2();\n\n      _this._drawBox(_this.player1);\n\n      _this._drawBox(_this.player2);\n\n      _this._drawBox(_this.boardDivider);\n\n      _this._drawBox(_this.gameBall);\n    };\n\n    _this._drawBox = function (box) {\n      _this.ctx.fillStyle = box.color;\n\n      _this.ctx.fillRect(box.x, box.y, box.width, box.height);\n    };\n\n    _this._displayScore1 = function () {\n      _this.ctx.font = \"20px Arial\";\n      _this.ctx.fillStyle = \"rgb(255, 255, 255)\";\n\n      _this.ctx.fillText(_this.p1Score, _this.canvas.width / 2 - (_this.p1Score > 9 ? 55 : 45), 30);\n    };\n\n    _this._displayScore2 = function () {\n      _this.ctx.font = \"20px Arial\";\n      _this.ctx.fillStyle = \"rgb(255, 255, 255)\";\n\n      _this.ctx.fillText(_this.p2Score, _this.canvas.width / 2 + 33, 30);\n    };\n\n    _this._userInput = function () {\n      if (87 in _this.keys) {\n        if (_this.player1.y - _this.player1.velocityY > 0) _this.player1.y -= _this.player1.velocityY;\n      } else if (83 in _this.keys) {\n        if (_this.player1.y + _this.player1.height + _this.player1.velocityY < _this.canvas.height) _this.player1.y += _this.player1.velocityY;\n      }\n\n      if (38 in _this.keys) {\n        if (_this.player2.y - _this.player2.velocityY > 0) _this.player2.y -= _this.player2.velocityY;\n      } else if (40 in _this.keys) {\n        if (_this.player2.y + _this.player2.height + _this.player2.velocityY < _this.canvas.height) _this.player2.y += _this.player2.velocityY;\n      }\n    };\n\n    _this.GameClasses = function () {\n      return {\n        //Fixed memory leak (I think) where the function Box was unintentionally leaking into global scope and not getting garbage collected.\n        Box: function Box(opts) {\n          var x = opts.x,\n              y = opts.y,\n              width = opts.width,\n              height = opts.height,\n              color = opts.color,\n              velocityX = opts.velocityX,\n              velocityY = opts.velocityY;\n          this.x = x || 10;\n          this.y = y || 10;\n          this.width = width || 40;\n          this.height = height || 50;\n          this.color = color || \"#FFF\";\n          this.velocityX = velocityX || 2;\n          this.velocityY = velocityY || 2;\n        }\n      };\n    }();\n\n    _this.initXVelocity = 2;\n    return _this;\n  }\n\n  _createClass(GameCanvas, [{\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"canvas\", {\n        id: \"pong_canvas\",\n        ref: \"pong_canvas\",\n        width: \"750\",\n        height: \"500\",\n        style: {\n          background: \"#12260e\",\n          border: \"4px solid #FFF\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return GameCanvas;\n}(Component);\n\nexport default GameCanvas;","map":{"version":3,"sources":["/Users/ericrohner/Projects/pong-r/src/components/GameCanvas.js"],"names":["React","Component","GameCanvas","props","componentDidMount","_initializeGameCanvas","canvas","refs","pong_canvas","ctx","getContext","p1Score","p2Score","keys","window","addEventListener","e","keyCode","target","nodeName","preventDefault","player1","GameClasses","Box","x","y","width","paddle1Width","height","color","velocityY","player2","boardDivider","gameBall","velocityX","_renderLoop","_ballCollisionY","_userInput","frameId","requestAnimationFrame","_ballCollisionX","initXVelocity","_drawRender","clearRect","_displayScore1","_displayScore2","_drawBox","box","fillStyle","fillRect","font","fillText","opts","background","border"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\n\nclass GameCanvas extends Component {\n  constructor(props) {\n    super(props);\n    //deadBalls is only ever pushed to, never referenced and never cleared\n    //we can safely remove it completely from the codebase\n    //this.deadBalls = [];\n    this.initXVelocity = 2;\n  }\n\n  componentDidMount = () => {\n    this._initializeGameCanvas();\n  };\n\n  _initializeGameCanvas = () => {\n    // initialize canvas element and bind it to our React class\n    this.canvas = this.refs.pong_canvas;\n    this.ctx = this.canvas.getContext(\"2d\");\n\n    // declare initial variables\n    this.p1Score = 0;\n    this.p2Score = 0;\n    this.keys = {};\n\n    // add keyboard input listeners to handle user interactions\n    window.addEventListener(\"keydown\", e => {\n      this.keys[e.keyCode] = 1;\n      if (e.target.nodeName !== \"INPUT\") e.preventDefault();\n    });\n    window.addEventListener(\"keyup\", e => delete this.keys[e.keyCode]);\n\n    // instantiate our game elements\n    this.player1 = new this.GameClasses.Box({\n      x: 10,\n      y: 200,\n      width: this.props.paddle1Width,\n      height: 80,\n      color: \"#FFF\",\n      velocityY: 2\n    });\n    this.player2 = new this.GameClasses.Box({\n      x: 725,\n      y: 200,\n      width: 15,\n      height: 80,\n      color: \"#FFF\",\n      velocityY: 2\n    });\n    this.boardDivider = new this.GameClasses.Box({\n      x: this.canvas.width / 2 - 2.5,\n      y: -1,\n      width: 5,\n      height: this.canvas.height + 1,\n      color: \"#FFF\"\n    });\n    this.gameBall = new this.GameClasses.Box({\n      x: this.canvas.width / 2,\n      y: this.canvas.height / 2,\n      width: 15,\n      height: 15,\n      color: \"#FF0000\",\n      velocityX: 1,\n      velocityY: 1\n    });\n\n    // start render loop\n    this._renderLoop();\n  };\n\n  // recursively process game state and redraw canvas\n  _renderLoop = () => {\n    this._ballCollisionY();\n    this._userInput(this.player1);\n    this._userInput(this.player2);\n    this.frameId = window.requestAnimationFrame(this._renderLoop);\n  };\n\n  // watch ball movement in Y dimension and handle top/bottom boundary collisions, then call _ballCollisionX\n  _ballCollisionY = () => {\n    if (\n      this.gameBall.y + this.gameBall.velocityY <= 0 ||\n      this.gameBall.y + this.gameBall.velocityY + this.gameBall.height >=\n        this.canvas.height\n    ) {\n      this.gameBall.velocityY = this.gameBall.velocityY * -1;\n      this.gameBall.x += this.gameBall.velocityX;\n      this.gameBall.y += this.gameBall.velocityY;\n    } else {\n      this.gameBall.x += this.gameBall.velocityX;\n      this.gameBall.y += this.gameBall.velocityY;\n    }\n    this._ballCollisionX();\n  };\n\n  // watch ball movement in X dimension and handle paddle collisions and score setting/ball resetting, then call _drawRender\n  _ballCollisionX = () => {\n    if (\n      this.gameBall.x + this.gameBall.velocityX <=\n        this.player1.x + this.player1.width &&\n      this.gameBall.y + this.gameBall.velocityY > this.player1.y &&\n      this.gameBall.y + this.gameBall.velocityY <=\n        this.player1.y + this.player1.height\n    ) {\n      //Fixed bug where \"catching\" the ball with the top or bottom of the paddle\n      //would result in it switching X direction every frame. Since few players have frame\n      //perfect timing this essentially gives the top and bottom of the paddle a 50/50 chance\n      //to lose the volley. Players don't like random chance when it can only hurt them.\n      this.gameBall.velocityX = this.initXVelocity;\n      //Added VelocityY change from moving paddle. Velocity change is increased every frame until\n      //the ball exits the paddle when hitting the ball with the top or bottom of the the paddle.\n      //As this requires skill and rewards the player by making a return more difficult it's a\n      //gameplay feature, not a bug. Also, it just feels right for the game physics.\n      if (83 in this.keys) {\n        this.gameBall.velocityY += 1;\n      } else if (87 in this.keys) {\n        this.gameBall.velocityY -= 1;\n      }\n    } else if (\n      this.gameBall.x + this.gameBall.width + this.gameBall.velocityX >=\n        this.player2.x &&\n      this.gameBall.y + this.gameBall.velocityY > this.player2.y &&\n      this.gameBall.y + this.gameBall.velocityY <=\n        this.player2.y + this.player2.height\n    ) {\n      //Fixed bug where \"catching\" the ball with the top or bottom of the paddle\n      //would result in it switching X direction every frame. Since few players have frame\n      //perfect timing this essentially gives the top and bottom of the paddle a 50/50 chance\n      //to lose the volley. Players don't like random chance when it can only hurt them.\n      this.gameBall.velocityX = this.initXVelocity * -1;\n      //Added VelocityY change from moving paddle. Velocity change is increased every frame until\n      //the ball exits the paddle when hitting the ball with the top or bottom of the the paddle.\n      //As this requires skill and rewards the player by making a return more difficult it's a\n      //gameplay feature, not a bug. Also, it just feels right for the game physics.\n      if (40 in this.keys) {\n        this.gameBall.velocityY += 1;\n      } else if (38 in this.keys) {\n        this.gameBall.velocityY -= 1;\n      }\n    } else if (\n      this.gameBall.x + this.gameBall.velocityX <\n      this.player1.x - 15\n    ) {\n      this.p2Score += 1;\n      //this.deadBalls appears to be an intentional memory leak\n      //this.deadBalls.push(this.gameBall);\n      this.gameBall = new this.GameClasses.Box({\n        x: this.canvas.width / 2,\n        y: this.canvas.height / 2,\n        width: 15,\n        height: 15,\n        color: \"#FF0000\",\n        velocityX: this.initXVelocity,\n        velocityY: 1\n      });\n    } else if (\n      this.gameBall.x + this.gameBall.velocityX >\n      this.player2.x + this.player2.width\n    ) {\n      this.p1Score += 1;\n      //this.deadBalls appears to be an intentional memory leak\n      //this.deadBalls.push(this.gameBall);\n      this.gameBall = new this.GameClasses.Box({\n        x: this.canvas.width / 2,\n        y: this.canvas.height / 2,\n        width: 15,\n        height: 15,\n        color: \"#FF0000\",\n        velocityX: this.initXVelocity * -1,\n        velocityY: 1\n      });\n    } else {\n      this.gameBall.x += this.gameBall.velocityX;\n      this.gameBall.y += this.gameBall.velocityY;\n    }\n    this._drawRender();\n  };\n\n  // clear canvas and redraw according to new game state\n  _drawRender = () => {\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this._displayScore1();\n    this._displayScore2();\n    this._drawBox(this.player1);\n    this._drawBox(this.player2);\n    this._drawBox(this.boardDivider);\n    this._drawBox(this.gameBall);\n  };\n\n  // take in game object and draw to canvas\n  _drawBox = box => {\n    this.ctx.fillStyle = box.color;\n    this.ctx.fillRect(box.x, box.y, box.width, box.height);\n  };\n\n  // render player 1 score\n  _displayScore1 = () => {\n    this.ctx.font = \"20px Arial\";\n    this.ctx.fillStyle = \"rgb(255, 255, 255)\";\n    this.ctx.fillText(\n      this.p1Score,\n      this.canvas.width / 2 - (this.p1Score > 9 ? 55 : 45),\n      30\n    );\n  };\n\n  // render player 2 score\n  _displayScore2 = () => {\n    this.ctx.font = \"20px Arial\";\n    this.ctx.fillStyle = \"rgb(255, 255, 255)\";\n    this.ctx.fillText(this.p2Score, this.canvas.width / 2 + 33, 30);\n  };\n\n  //track user input\n  _userInput = () => {\n    if (87 in this.keys) {\n      if (this.player1.y - this.player1.velocityY > 0)\n        this.player1.y -= this.player1.velocityY;\n    } else if (83 in this.keys) {\n      if (\n        this.player1.y + this.player1.height + this.player1.velocityY <\n        this.canvas.height\n      )\n        this.player1.y += this.player1.velocityY;\n    }\n\n    if (38 in this.keys) {\n      if (this.player2.y - this.player2.velocityY > 0)\n        this.player2.y -= this.player2.velocityY;\n    } else if (40 in this.keys) {\n      if (\n        this.player2.y + this.player2.height + this.player2.velocityY <\n        this.canvas.height\n      )\n        this.player2.y += this.player2.velocityY;\n    }\n  };\n\n  GameClasses = (() => {\n    return {\n      //Fixed memory leak (I think) where the function Box was unintentionally leaking into global scope and not getting garbage collected.\n      Box(opts) {\n        let { x, y, width, height, color, velocityX, velocityY } = opts;\n        this.x = x || 10;\n        this.y = y || 10;\n        this.width = width || 40;\n        this.height = height || 50;\n        this.color = color || \"#FFF\";\n        this.velocityX = velocityX || 2;\n        this.velocityY = velocityY || 2;\n      }\n    };\n  })();\n\n  render() {\n    return (\n      <canvas\n        id=\"pong_canvas\"\n        ref=\"pong_canvas\"\n        width=\"750\"\n        height=\"500\"\n        style={{ background: \"#12260e\", border: \"4px solid #FFF\" }}\n      />\n    );\n  }\n}\n\nexport default GameCanvas;\n"]},"metadata":{},"sourceType":"module"}