{"ast":null,"code":"import _classCallCheck from \"/Users/ericrohner/Projects/pong-r/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/ericrohner/Projects/pong-r/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/ericrohner/Projects/pong-r/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/ericrohner/Projects/pong-r/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/ericrohner/Projects/pong-r/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/ericrohner/Projects/pong-r/src/components/GameCanvas.js\";\nimport React, { Component } from \"react\";\n\nvar GameCanvas =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(GameCanvas, _Component);\n\n  function GameCanvas(props) {\n    var _this;\n\n    _classCallCheck(this, GameCanvas);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(GameCanvas).call(this, props)); //deadBalls is only ever pushed to, never referenced and never cleared\n    //we can safely remove it completely from the codebase\n    //this.deadBalls = [];\n\n    _this.componentDidMount = function () {\n      _this._initializeGameCanvas();\n    };\n\n    _this._initializeGameCanvas = function () {\n      // initialize canvas element and bind it to our React class\n      _this.canvas = _this.refs.pong_canvas;\n      _this.ctx = _this.canvas.getContext(\"2d\"); // declare initial variables\n\n      _this.p1Score = 0;\n      _this.p2Score = 0;\n      _this.keys = {}; // add keyboard input listeners to handle user interactions\n\n      window.addEventListener(\"keydown\", function (e) {\n        _this.keys[e.keyCode] = 1;\n        if (e.target.nodeName !== \"INPUT\") e.preventDefault();\n      });\n      window.addEventListener(\"keyup\", function (e) {\n        return delete _this.keys[e.keyCode];\n      }); // instantiate our game elements\n\n      _this.player1 = new _this.GameClasses.Box({\n        x: 10,\n        y: 200,\n        width: _this.props.paddle1Width,\n        height: _this.props.paddle1Height,\n        color: \"#FFF\",\n        velocityY: 2\n      });\n      _this.player2 = new _this.GameClasses.Box({\n        x: 725,\n        y: 200,\n        width: _this.props.paddle2Width,\n        height: _this.props.paddle2Height,\n        color: \"#FFF\",\n        velocityY: 2\n      });\n      _this.boardDivider = new _this.GameClasses.Box({\n        x: _this.canvas.width / 2 - 2.5,\n        y: -1,\n        width: 5,\n        height: _this.canvas.height + 1,\n        color: \"#FFF\"\n      });\n      _this.gameBall = new _this.GameClasses.Box({\n        x: _this.canvas.width / 2,\n        y: _this.canvas.height / 2,\n        width: 15,\n        height: 15,\n        color: \"#FF0000\",\n        velocityX: 1,\n        velocityY: 1\n      }); // start render loop\n\n      _this._renderLoop();\n    };\n\n    _this._renderLoop = function () {\n      _this._updateConfig();\n\n      _this._ballCollisionY();\n\n      _this._userInput(_this.player1);\n\n      _this._userInput(_this.player2);\n\n      _this.frameId = window.requestAnimationFrame(_this._renderLoop);\n    };\n\n    _this._updateConfig = function () {\n      _this.player1.width = _this.props.player1Width;\n      _this.player1.height = _this.props.player1Height;\n      _this.player1.width = _this.props.player2Width;\n      _this.player1.height = _this.props.player2Height;\n    };\n\n    _this._ballCollisionY = function () {\n      if (_this.gameBall.y + _this.gameBall.velocityY <= 0 || _this.gameBall.y + _this.gameBall.velocityY + _this.gameBall.height >= _this.canvas.height) {\n        _this.gameBall.velocityY = _this.gameBall.velocityY * -1;\n        _this.gameBall.x += _this.gameBall.velocityX;\n        _this.gameBall.y += _this.gameBall.velocityY;\n      } else {\n        _this.gameBall.x += _this.gameBall.velocityX;\n        _this.gameBall.y += _this.gameBall.velocityY;\n      }\n\n      _this._ballCollisionX();\n    };\n\n    _this._ballCollisionX = function () {\n      if (_this.gameBall.x + _this.gameBall.velocityX <= _this.player1.x + _this.player1.width && _this.gameBall.y + _this.gameBall.velocityY > _this.player1.y && _this.gameBall.y + _this.gameBall.velocityY <= _this.player1.y + _this.player1.height) {\n        //Fixed bug where \"catching\" the ball with the top or bottom of the paddle\n        //would result in it switching X direction every frame. Since few players have frame\n        //perfect timing this essentially gives the top and bottom of the paddle a 50/50 chance\n        //to lose the volley. Players don't like random chance when it can only hurt them.\n        _this.gameBall.velocityX = _this.initXVelocity; //Added VelocityY change from moving paddle. Velocity change is increased every frame until\n        //the ball exits the paddle when hitting the ball with the top or bottom of the the paddle.\n        //As this requires skill and rewards the player by making a return more difficult it's a\n        //gameplay feature, not a bug. Also, it just feels right for the game physics.\n\n        if (83 in _this.keys) {\n          _this.gameBall.velocityY += 1;\n        } else if (87 in _this.keys) {\n          _this.gameBall.velocityY -= 1;\n        }\n      } else if (_this.gameBall.x + _this.gameBall.width + _this.gameBall.velocityX >= _this.player2.x && _this.gameBall.y + _this.gameBall.velocityY > _this.player2.y && _this.gameBall.y + _this.gameBall.velocityY <= _this.player2.y + _this.player2.height) {\n        //Fixed bug where \"catching\" the ball with the top or bottom of the paddle\n        //would result in it switching X direction every frame. Since few players have frame\n        //perfect timing this essentially gives the top and bottom of the paddle a 50/50 chance\n        //to lose the volley. Players don't like random chance when it can only hurt them.\n        _this.gameBall.velocityX = _this.initXVelocity * -1; //Added VelocityY change from moving paddle. Velocity change is increased every frame until\n        //the ball exits the paddle when hitting the ball with the top or bottom of the the paddle.\n        //As this requires skill and rewards the player by making a return more difficult it's a\n        //gameplay feature, not a bug. Also, it just feels right for the game physics.\n\n        if (40 in _this.keys) {\n          _this.gameBall.velocityY += 1;\n        } else if (38 in _this.keys) {\n          _this.gameBall.velocityY -= 1;\n        }\n      } else if (_this.gameBall.x + _this.gameBall.velocityX < _this.player1.x - 15) {\n        _this.p2Score += 1; //this.deadBalls appears to be an intentional memory leak\n        //this.deadBalls.push(this.gameBall);\n\n        _this.gameBall = new _this.GameClasses.Box({\n          x: _this.canvas.width / 2,\n          y: _this.canvas.height / 2,\n          width: 15,\n          height: 15,\n          color: \"#FF0000\",\n          velocityX: _this.initXVelocity,\n          velocityY: 1\n        });\n      } else if (_this.gameBall.x + _this.gameBall.velocityX > _this.player2.x + _this.player2.width) {\n        _this.p1Score += 1; //this.deadBalls appears to be an intentional memory leak\n        //this.deadBalls.push(this.gameBall);\n\n        _this.gameBall = new _this.GameClasses.Box({\n          x: _this.canvas.width / 2,\n          y: _this.canvas.height / 2,\n          width: 15,\n          height: 15,\n          color: \"#FF0000\",\n          velocityX: _this.initXVelocity * -1,\n          velocityY: 1\n        });\n      } else {\n        _this.gameBall.x += _this.gameBall.velocityX;\n        _this.gameBall.y += _this.gameBall.velocityY;\n      }\n\n      _this._drawRender();\n    };\n\n    _this._drawRender = function () {\n      _this.ctx.clearRect(0, 0, _this.canvas.width, _this.canvas.height);\n\n      _this._displayScore1();\n\n      _this._displayScore2();\n\n      _this._drawBox(_this.player1);\n\n      _this._drawBox(_this.player2);\n\n      _this._drawBox(_this.boardDivider);\n\n      _this._drawBox(_this.gameBall);\n    };\n\n    _this._drawBox = function (box) {\n      _this.ctx.fillStyle = box.color;\n\n      _this.ctx.fillRect(box.x, box.y, box.width, box.height);\n    };\n\n    _this._displayScore1 = function () {\n      _this.ctx.font = \"20px Arial\";\n      _this.ctx.fillStyle = \"rgb(255, 255, 255)\";\n\n      _this.ctx.fillText(_this.p1Score, _this.canvas.width / 2 - (_this.p1Score > 9 ? 55 : 45), 30);\n    };\n\n    _this._displayScore2 = function () {\n      _this.ctx.font = \"20px Arial\";\n      _this.ctx.fillStyle = \"rgb(255, 255, 255)\";\n\n      _this.ctx.fillText(_this.p2Score, _this.canvas.width / 2 + 33, 30);\n    };\n\n    _this._userInput = function () {\n      if (87 in _this.keys) {\n        if (_this.player1.y - _this.player1.velocityY > 0) _this.player1.y -= _this.player1.velocityY;\n      } else if (83 in _this.keys) {\n        if (_this.player1.y + _this.player1.height + _this.player1.velocityY < _this.canvas.height) _this.player1.y += _this.player1.velocityY;\n      }\n\n      if (38 in _this.keys) {\n        if (_this.player2.y - _this.player2.velocityY > 0) _this.player2.y -= _this.player2.velocityY;\n      } else if (40 in _this.keys) {\n        if (_this.player2.y + _this.player2.height + _this.player2.velocityY < _this.canvas.height) _this.player2.y += _this.player2.velocityY;\n      }\n    };\n\n    _this.GameClasses = function () {\n      return {\n        //Fixed memory leak (I think) where the function Box was unintentionally leaking into global scope and not getting garbage collected.\n        Box: function Box(opts) {\n          var x = opts.x,\n              y = opts.y,\n              width = opts.width,\n              height = opts.height,\n              color = opts.color,\n              velocityX = opts.velocityX,\n              velocityY = opts.velocityY;\n          this.x = x || 10;\n          this.y = y || 10;\n          this.width = width || 40;\n          this.height = height || 50;\n          this.color = color || \"#FFF\";\n          this.velocityX = velocityX || 2;\n          this.velocityY = velocityY || 2;\n        }\n      };\n    }();\n\n    _this.initXVelocity = 2;\n    return _this;\n  }\n\n  _createClass(GameCanvas, [{\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"canvas\", {\n        id: \"pong_canvas\",\n        ref: \"pong_canvas\",\n        width: \"750\",\n        height: \"500\",\n        style: {\n          background: \"#12260e\",\n          border: \"4px solid #FFF\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return GameCanvas;\n}(Component);\n\nexport default GameCanvas;","map":{"version":3,"sources":["/Users/ericrohner/Projects/pong-r/src/components/GameCanvas.js"],"names":["React","Component","GameCanvas","props","componentDidMount","_initializeGameCanvas","canvas","refs","pong_canvas","ctx","getContext","p1Score","p2Score","keys","window","addEventListener","e","keyCode","target","nodeName","preventDefault","player1","GameClasses","Box","x","y","width","paddle1Width","height","paddle1Height","color","velocityY","player2","paddle2Width","paddle2Height","boardDivider","gameBall","velocityX","_renderLoop","_updateConfig","_ballCollisionY","_userInput","frameId","requestAnimationFrame","player1Width","player1Height","player2Width","player2Height","_ballCollisionX","initXVelocity","_drawRender","clearRect","_displayScore1","_displayScore2","_drawBox","box","fillStyle","fillRect","font","fillText","opts","background","border"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\n\nclass GameCanvas extends Component {\n  constructor(props) {\n    super(props);\n    //deadBalls is only ever pushed to, never referenced and never cleared\n    //we can safely remove it completely from the codebase\n    //this.deadBalls = [];\n    this.initXVelocity = 2;\n  }\n\n  componentDidMount = () => {\n    this._initializeGameCanvas();\n  };\n\n  _initializeGameCanvas = () => {\n    // initialize canvas element and bind it to our React class\n    this.canvas = this.refs.pong_canvas;\n    this.ctx = this.canvas.getContext(\"2d\");\n\n    // declare initial variables\n    this.p1Score = 0;\n    this.p2Score = 0;\n    this.keys = {};\n\n    // add keyboard input listeners to handle user interactions\n    window.addEventListener(\"keydown\", e => {\n      this.keys[e.keyCode] = 1;\n      if (e.target.nodeName !== \"INPUT\") e.preventDefault();\n    });\n    window.addEventListener(\"keyup\", e => delete this.keys[e.keyCode]);\n\n    // instantiate our game elements\n    this.player1 = new this.GameClasses.Box({\n      x: 10,\n      y: 200,\n      width: this.props.paddle1Width,\n      height: this.props.paddle1Height,\n      color: \"#FFF\",\n      velocityY: 2\n    });\n    this.player2 = new this.GameClasses.Box({\n      x: 725,\n      y: 200,\n      width: this.props.paddle2Width,\n      height: this.props.paddle2Height,\n      color: \"#FFF\",\n      velocityY: 2\n    });\n    this.boardDivider = new this.GameClasses.Box({\n      x: this.canvas.width / 2 - 2.5,\n      y: -1,\n      width: 5,\n      height: this.canvas.height + 1,\n      color: \"#FFF\"\n    });\n    this.gameBall = new this.GameClasses.Box({\n      x: this.canvas.width / 2,\n      y: this.canvas.height / 2,\n      width: 15,\n      height: 15,\n      color: \"#FF0000\",\n      velocityX: 1,\n      velocityY: 1\n    });\n\n    // start render loop\n    this._renderLoop();\n  };\n\n  // recursively process game state and redraw canvas\n  _renderLoop = () => {\n    this._updateConfig();\n    this._ballCollisionY();\n    this._userInput(this.player1);\n    this._userInput(this.player2);\n    this.frameId = window.requestAnimationFrame(this._renderLoop);\n  };\n\n  // change game configuration as new info comes in from server\n  _updateConfig = () => {\n    this.player1.width = this.props.player1Width\n    this.player1.height = this.props.player1Height\n    this.player1.width = this.props.player2Width\n    this.player1.height = this.props.player2Height\n  }\n\n  // watch ball movement in Y dimension and handle top/bottom boundary collisions, then call _ballCollisionX\n  _ballCollisionY = () => {\n    if (\n      this.gameBall.y + this.gameBall.velocityY <= 0 ||\n      this.gameBall.y + this.gameBall.velocityY + this.gameBall.height >=\n        this.canvas.height\n    ) {\n      this.gameBall.velocityY = this.gameBall.velocityY * -1;\n      this.gameBall.x += this.gameBall.velocityX;\n      this.gameBall.y += this.gameBall.velocityY;\n    } else {\n      this.gameBall.x += this.gameBall.velocityX;\n      this.gameBall.y += this.gameBall.velocityY;\n    }\n    this._ballCollisionX();\n  };\n\n  // watch ball movement in X dimension and handle paddle collisions and score setting/ball resetting, then call _drawRender\n  _ballCollisionX = () => {\n    if (\n      this.gameBall.x + this.gameBall.velocityX <=\n        this.player1.x + this.player1.width &&\n      this.gameBall.y + this.gameBall.velocityY > this.player1.y &&\n      this.gameBall.y + this.gameBall.velocityY <=\n        this.player1.y + this.player1.height\n    ) {\n      //Fixed bug where \"catching\" the ball with the top or bottom of the paddle\n      //would result in it switching X direction every frame. Since few players have frame\n      //perfect timing this essentially gives the top and bottom of the paddle a 50/50 chance\n      //to lose the volley. Players don't like random chance when it can only hurt them.\n      this.gameBall.velocityX = this.initXVelocity;\n      //Added VelocityY change from moving paddle. Velocity change is increased every frame until\n      //the ball exits the paddle when hitting the ball with the top or bottom of the the paddle.\n      //As this requires skill and rewards the player by making a return more difficult it's a\n      //gameplay feature, not a bug. Also, it just feels right for the game physics.\n      if (83 in this.keys) {\n        this.gameBall.velocityY += 1;\n      } else if (87 in this.keys) {\n        this.gameBall.velocityY -= 1;\n      }\n    } else if (\n      this.gameBall.x + this.gameBall.width + this.gameBall.velocityX >=\n        this.player2.x &&\n      this.gameBall.y + this.gameBall.velocityY > this.player2.y &&\n      this.gameBall.y + this.gameBall.velocityY <=\n        this.player2.y + this.player2.height\n    ) {\n      //Fixed bug where \"catching\" the ball with the top or bottom of the paddle\n      //would result in it switching X direction every frame. Since few players have frame\n      //perfect timing this essentially gives the top and bottom of the paddle a 50/50 chance\n      //to lose the volley. Players don't like random chance when it can only hurt them.\n      this.gameBall.velocityX = this.initXVelocity * -1;\n      //Added VelocityY change from moving paddle. Velocity change is increased every frame until\n      //the ball exits the paddle when hitting the ball with the top or bottom of the the paddle.\n      //As this requires skill and rewards the player by making a return more difficult it's a\n      //gameplay feature, not a bug. Also, it just feels right for the game physics.\n      if (40 in this.keys) {\n        this.gameBall.velocityY += 1;\n      } else if (38 in this.keys) {\n        this.gameBall.velocityY -= 1;\n      }\n    } else if (\n      this.gameBall.x + this.gameBall.velocityX <\n      this.player1.x - 15\n    ) {\n      this.p2Score += 1;\n      //this.deadBalls appears to be an intentional memory leak\n      //this.deadBalls.push(this.gameBall);\n      this.gameBall = new this.GameClasses.Box({\n        x: this.canvas.width / 2,\n        y: this.canvas.height / 2,\n        width: 15,\n        height: 15,\n        color: \"#FF0000\",\n        velocityX: this.initXVelocity,\n        velocityY: 1\n      });\n    } else if (\n      this.gameBall.x + this.gameBall.velocityX >\n      this.player2.x + this.player2.width\n    ) {\n      this.p1Score += 1;\n      //this.deadBalls appears to be an intentional memory leak\n      //this.deadBalls.push(this.gameBall);\n      this.gameBall = new this.GameClasses.Box({\n        x: this.canvas.width / 2,\n        y: this.canvas.height / 2,\n        width: 15,\n        height: 15,\n        color: \"#FF0000\",\n        velocityX: this.initXVelocity * -1,\n        velocityY: 1\n      });\n    } else {\n      this.gameBall.x += this.gameBall.velocityX;\n      this.gameBall.y += this.gameBall.velocityY;\n    }\n    this._drawRender();\n  };\n\n  // clear canvas and redraw according to new game state\n  _drawRender = () => {\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this._displayScore1();\n    this._displayScore2();\n    this._drawBox(this.player1);\n    this._drawBox(this.player2);\n    this._drawBox(this.boardDivider);\n    this._drawBox(this.gameBall);\n  };\n\n  // take in game object and draw to canvas\n  _drawBox = box => {\n    this.ctx.fillStyle = box.color;\n    this.ctx.fillRect(box.x, box.y, box.width, box.height);\n  };\n\n  // render player 1 score\n  _displayScore1 = () => {\n    this.ctx.font = \"20px Arial\";\n    this.ctx.fillStyle = \"rgb(255, 255, 255)\";\n    this.ctx.fillText(\n      this.p1Score,\n      this.canvas.width / 2 - (this.p1Score > 9 ? 55 : 45),\n      30\n    );\n  };\n\n  // render player 2 score\n  _displayScore2 = () => {\n    this.ctx.font = \"20px Arial\";\n    this.ctx.fillStyle = \"rgb(255, 255, 255)\";\n    this.ctx.fillText(this.p2Score, this.canvas.width / 2 + 33, 30);\n  };\n\n  //track user input\n  _userInput = () => {\n    if (87 in this.keys) {\n      if (this.player1.y - this.player1.velocityY > 0)\n        this.player1.y -= this.player1.velocityY;\n    } else if (83 in this.keys) {\n      if (\n        this.player1.y + this.player1.height + this.player1.velocityY <\n        this.canvas.height\n      )\n        this.player1.y += this.player1.velocityY;\n    }\n\n    if (38 in this.keys) {\n      if (this.player2.y - this.player2.velocityY > 0)\n        this.player2.y -= this.player2.velocityY;\n    } else if (40 in this.keys) {\n      if (\n        this.player2.y + this.player2.height + this.player2.velocityY <\n        this.canvas.height\n      )\n        this.player2.y += this.player2.velocityY;\n    }\n  };\n\n  GameClasses = (() => {\n    return {\n      //Fixed memory leak (I think) where the function Box was unintentionally leaking into global scope and not getting garbage collected.\n      Box(opts) {\n        let { x, y, width, height, color, velocityX, velocityY } = opts;\n        this.x = x || 10;\n        this.y = y || 10;\n        this.width = width || 40;\n        this.height = height || 50;\n        this.color = color || \"#FFF\";\n        this.velocityX = velocityX || 2;\n        this.velocityY = velocityY || 2;\n      }\n    };\n  })();\n\n  render() {\n    return (\n      <canvas\n        id=\"pong_canvas\"\n        ref=\"pong_canvas\"\n        width=\"750\"\n        height=\"500\"\n        style={{ background: \"#12260e\", border: \"4px solid #FFF\" }}\n      />\n    );\n  }\n}\n\nexport default GameCanvas;\n"]},"metadata":{},"sourceType":"module"}